<div class="layui-form-item">
  <div class="layui-inline">
    <label class="layui-form-label">
      <span class="x-red">*</span>巡视日期
    </label>
    <div class="layui-input-inline">
      <input type="text" value="{$model.patrol_date}" name="patrol_date" id="patrol_date" datatype="*" autocomplete="off" class="layui-input">
    </div>
    <div class="layui-form-mid layui-word-aux w100">
      <span class="Validform_checktip">请选择巡视日期</span>
    </div>
  </div>

  <div class="layui-inline">
    <label class="layui-form-label">
      <span class="x-red">*</span>时间
    </label>
    <div class="layui-input-inline">
      <input type="text" value="{$model.patrol_time}" name="patrol_time" id="patrol_time" datatype="*" autocomplete="off" class="layui-input">
    </div>
    <div class="layui-form-mid layui-word-aux w100">
      <span class="Validform_checktip">请选择时间</span>
    </div>
  </div>
</div>

<div class="layui-form-item">
  <div class="layui-inline">
    <label class="layui-form-label">
      <span class="x-red">*</span>巡视人员一
    </label>
    <div class="layui-input-inline">
      <select name="worker1" datatype="*" id="worker1" lay-search>
        <option value="">无</option>
        {foreach name="worker_list" item="item"}
        <option value="{$item['value']}" {eq name="model.worker1" value="$item['value']" } selected="selected" {/eq}>{$item.key}</option>
        {/foreach}
      </select>
    </div>
    <div class="layui-form-mid layui-word-aux w100">
      <span class="Validform_checktip">请选择巡视人员</span>
    </div>
  </div>

  <div class="layui-inline">
    <label class="layui-form-label">
      <span class="x-red">*</span>巡视人员二
    </label>
    <div class="layui-input-inline">
      <select name="worker2" datatype="*" id="worker2" lay-search="lay-search">
        <option value="">无</option>
        {foreach name="worker_list" item="item"}
        <option value="{$item['value']}" {eq name="model.worker2" value="$item['value']" } selected="selected" {/eq}>{$item.key}</option>
        {/foreach}
      </select>
    </div>
    <div class="layui-form-mid layui-word-aux w100">
      <span class="Validform_checktip">请选择巡视人员</span>
    </div>
  </div>
</div>

<div class="layui-form-item">
  <div class="layui-inline">
    <label class="layui-form-label">
      <span class="x-red">*</span>鸟名
    </label>
    <div class="layui-input-inline">
      <select name="bird_name" id="bird_name" datatype="*" lay-search="lay-search">
        <option value="">无</option>
        {foreach name="bird_name_list" item="item"}
        <option value="{$item['value']}" {eq name="model.bird_name" value="$item['value']" } selected="selected" {/eq}>{$item.key}</option>
        {/foreach}
      </select>
    </div>
    <div class="layui-form-mid layui-word-aux w100">
      <span class="Validform_checktip">请选择鸟名</span>
    </div>
  </div>

  <div class="layui-inline">
    <label class="layui-form-label">
      <span class="x-red">*</span>数量
    </label>
    <div class="layui-input-inline">
      <input type="text" value="{$model.bird_num}" name="bird_num" id="bird_num" datatype="*" autocomplete="off" class="layui-input">
    </div>
    <div class="layui-form-mid layui-word-aux w100">
      <span class="Validform_checktip ">请填写数量</span>
    </div>
  </div>
</div>

<div class="layui-form-item">
  <div class="layui-inline">
    <label class="layui-form-label">
      <span class="x-red">*</span>区域
    </label>
    <div class="layui-input-inline">
      <select name="area" id="area" datatype="*" lay-search="lay-search">
        <option value="">无</option>
        {foreach name="area_list" item="item"}
        <option value="{$item['value']}" {eq name="model.area" value="$item['value']" } selected="selected" {/eq}>{$item.key}</option>
        {/foreach}
      </select>
    </div>
    <div class="layui-form-mid layui-word-aux w100">
      <a style="color:#1E9FFF;cursor: pointer" onclick="x_admin_show('添加鸟情区域','{:url('BirdArea/add')}')">新增区域</a>
    </div>
  </div>

  <div class="layui-inline">
    <label class="layui-form-label">
      <span class="x-red">*</span>高度
    </label>
    <div class="layui-input-inline">
      <select name="height" id="height" datatype="*" lay-search="lay-search">
        <option value="">无</option>
        {foreach name="bird_drive_height_list" item="item"}
        <option value="{$item['value']}" {eq name="model.height" value="$item['value']" } selected="selected" {/eq}>{$item.value}</option>
        {/foreach}
      </select>
    </div>
    <div class="layui-form-mid layui-word-aux w100">
      <span class="Validform_checktip">请选择高度</span>
    </div>
  </div>
</div>

<hr/>
<div class="layui-form-item">
  <div class="layui-inline">
    <label class="layui-form-label">
      <span class="x-red">*</span>驱赶措施1
    </label>
    <div class="layui-input-inline">
      <select name="drive_method1" id="drive_method1" datatype="*" lay-search="lay-search">
        <option value="">无</option>
        {foreach name="bird_drive_method_list" item="item"}
        <option value="{$item['value']}" {eq name="model.drive_method1" value="$item['value']" } selected="selected" {/eq}>{$item.value}</option>
        {/foreach}
      </select>
    </div>
    <div class="layui-form-mid layui-word-aux w100">
      <span class="Validform_checktip">请选择驱赶措施</span>
    </div>
  </div>

  <div class="layui-inline">
    <label class="layui-form-label">
      弹药数量1
    </label>
    <div class="layui-input-inline">
      <input type="text" value="{$model.bullet_num1|default=0}" name="bullet_num1" id="bullet_num1" autocomplete="off" class="layui-input">
    </div>
    <div class="layui-form-mid layui-word-aux w100">
      <span class="Validform_checktip ">请填写弹药数量1</span>
    </div>
  </div>
</div>

<div class="layui-form-item">
  <label class="layui-form-label">
    <span class="x-red">*</span>驱赶效果1
  </label>
  <div class="layui-input-inline">
    <select name="drive_result1" id="drive_result1" datatype="*" lay-search="lay-search">
      <option value="">无</option>
      {foreach name="bird_drive_result_list" item="item"}
      <option value="{$item['value']}" {eq name="model.drive_result1" value="$item['value']" } selected="selected" {/eq}>{$item.value}</option>
      {/foreach}
    </select>
  </div>
  <div class="layui-form-mid layui-word-aux w100">
    <span class="Validform_checktip">请选择驱赶效果1</span>
  </div>
</div>

<hr/>

<div class="layui-form-item">
  <div class="layui-inline">
    <label class="layui-form-label">
      驱赶措施2
    </label>
    <div class="layui-input-inline">
      <select name="drive_method2" id="drive_method2" lay-search="lay-search">
        <option value="">无</option>
        {foreach name="bird_drive_method_2_list" item="item"}
        <option value="{$item['value']}" {eq name="model.drive_method2" value="$item['value']" } selected="selected" {/eq}>{$item.value}</option>
        {/foreach}
      </select>
    </div>
    <div class="layui-form-mid layui-word-aux w100">
      <span class="Validform_checktip">请选择驱赶措施</span>
    </div>
  </div>

  <div class="layui-inline">
    <label class="layui-form-label">
      弹药数量2
    </label>
    <div class="layui-input-inline">
      <input type="text" value="{$model.bullet_num2|default=0}" name="bullet_num2" id="bullet_num2" autocomplete="off" class="layui-input">
    </div>
    <div class="layui-form-mid layui-word-aux w100">
      <span class="Validform_checktip ">请填写弹药数量2</span>
    </div>
  </div>
</div>

<div class="layui-form-item">
  <div class="layui-inline">
    <label class="layui-form-label">
      驱赶效果2
    </label>
    <div class="layui-input-inline">
      <select name="drive_result2" id="drive_result2" lay-search="lay-search">
        <option value="">无</option>
        {foreach name="bird_drive_result_list" item="item"}
        <option value="{$item['value']}" {eq name="model.drive_result2" value="$item['value']" } selected="selected" {/eq}>{$item.value}</option>
        {/foreach}
      </select>
    </div>
    <div class="layui-form-mid layui-word-aux w100">
      <span class="Validform_checktip">请选择驱赶效果2</span>
    </div>
  </div>

  {eq name=":request()->action()" value="add"}
  <div class="layui-inline">
    <label class="layui-form-label">
      活动路线
    </label>
    <div class="layui-input-inline">
      <div class="button-content">
        <div id="hasDraw">
          <span>已绘制</span> <a class="link-content" onclick="openWindow()">点击重绘</a>
        </div>
        <div id="unDraw">
          <span>未绘制</span> <a class="link-content" onclick="openWindow()">点击绘制</a>
        </div>
        <input type="hidden" id="activity_line" name="activity_line">
      </div>
    </div>
  </div>

  <script>
    $(function(){
      $('#hasDraw').hide();
    })
    function addData(data) {
      var strList = [];
      for(let i=0; i<data.length; i++){
        var str = data[i].join(',');
        strList.push(str);
      }
      var dataStr = strList.join('/');
      $('#activity_line').val(dataStr);
      if(data && data.length > 0){
        $('#unDraw').hide();
        $('#hasDraw').show();
      }else{
        $('#unDraw').show();
        $('#hasDraw').hide();
      }
    }

    function openWindow(){
      var dataStr = $('#activity_line').val();
      if(!dataStr){
        dataStr = '';
      }
      var url = "{:url('BirdExpulsion/addLine')}";
      url = url + "?points=" + dataStr;
      var w = ($(window).width()*0.9);
      var h = ($(window).height() - 50);
      layer.open({
        type: 2,
        area: [w+'px', h +'px'],
        fix: false, //不固定
        maxmin: true,
        shadeClose: true,
        shade:0.4,
        title: '添加危险鸟类活动路线',
        content: url
      });
    }
  </script>
  {/eq}

  {eq name=":request()->action()" value="edit"}
  <div class="layui-inline">
    <label class="layui-form-label">
      活动路线
    </label>
    <div class="layui-input-inline">
      <div class="button-content">
        <div id="hasDraw">
          <span>已绘制</span> <a class="link-content" onclick="openWindow()">点击重绘</a>
        </div>
        <div id="unDraw">
          <span>未绘制</span> <a class="link-content" onclick="openWindow()">点击绘制</a>
        </div>
      </div>
      <input type="hidden" id="activity_line" name="activity_line" value="{$model.activity_line_gcj02}">
    </div>
  </div>

  <script>
    $(function(){
      var initData = "{$model.activity_line_gcj02}";
      if(initData && initData != ''){
        $('#unDraw').hide();
        $('#hasDraw').show();
      }else{
        $('#unDraw').show();
        $('#hasDraw').hide();
      }
    })
    function addData(data) {
      var strList = [];
      for(let i=0; i<data.length; i++){
        var str = data[i].join(',');
        strList.push(str);
      }
      var dataStr = strList.join('/');
      $('#activity_line').val(dataStr);
      if(data && data.length > 0){
        $('#unDraw').hide();
        $('#hasDraw').show();
      }else{
        $('#unDraw').show();
        $('#hasDraw').hide();
      }
    }

    function openWindow(){
      var dataStr = $('#activity_line').val();
      if(!dataStr){
        dataStr = '';
      }
      var url = "{:url('BirdExpulsion/addLine')}";
      url = url + "?points=" + dataStr;
      var w = ($(window).width()*0.9);
      var h = ($(window).height() - 50);
      layer.open({
        type: 2,
        area: [w+'px', h +'px'],
        fix: false, //不固定
        maxmin: true,
        shadeClose: true,
        shade:0.4,
        title: '添加危险鸟类活动路线',
        content: url
      });
    }
  </script>
  {/eq}
</div>

<hr/>

<div class="layui-form-item">
  <label class="layui-form-label">
    <span class="x-red">*</span>危险等级
  </label>
  <div class="layui-input-inline">
    <select name="danger_level" id="danger_level" datatype="*" lay-search="lay-search">
      <option value="">无</option>
      {foreach name="bird_drive_level_list" item="item"}
      <option value="{$item['value']}" {eq name="model.danger_level" value="$item['value']" } selected="selected" {/eq}>{$item.value}</option>
      {/foreach}
    </select>
  </div>
  <div class="layui-form-mid layui-word-aux w100">
    <span class="Validform_checktip">请选择危险等级</span>
  </div>
</div>

{foreach name="renderHTML" item="item"}{$item}{/foreach}

<div class="layui-form-item">
  <label class="layui-form-label">
    <span class="x-red">*</span>录入人员
  </label>
  <div class="layui-input-inline">
    <select name="aid" datatype="*" id="aid" lay-search>
      <option value="">无</option>
      {foreach name="entering_list" item="item"}
    <option value="{$item.key}" {eq name="model.aid" value="$item['key']" } selected="selected" {/eq}>{$item.value}</option>
      {/foreach}
    </select>
  </div>
  <div class="layui-form-mid layui-word-aux w100">
    <span class="Validform_checktip">请选择录入人员</span>
  </div>
</div>

<div class="layui-form-item layui-form-text">
  <label class="layui-form-label">备注</label>
  <div class="layui-input-inline w300">
    <textarea id="remarks" name="remarks" placeholder="请输入备注" class="layui-textarea h100">{$model.remarks}</textarea>
  </div>
</div>

<div class="layui-form-item">
  <label class="layui-form-label"></label>
  <button class="layui-btn" type="submit">
    提交
  </button>
</div>

<script>
  layui.use('laydate', function () {
    var laydate = layui.laydate;
    laydate.render({elem: '#patrol_date', format: 'yyyy/M/d'});
    laydate.render({elem: '#patrol_time', type: 'time', format: "H:mm"});
  });
</script>

<script>
  $(function () {
    $(".mainform").Validform({
      tiptype: function (msg, o, cssctl) {
        if(!o.obj.is("form")){
          var objtip = o.obj.parent().siblings(".layui-word-aux").children(".Validform_checktip");
          cssctl(objtip, o.type);
          objtip.html(msg);
        }
        else{
          var objtip = o.obj.find("#msgdemo");
          cssctl(objtip, o.type);
          objtip.html(msg);
        }
      },
      ajaxPost: true,
      callback: function (data) {
        if(data.code == 1){
          layer.alert(data.msg, { icon: 6 }, function () {
            var index = parent.layer.getFrameIndex(window.name);
            parent.location.reload();
            parent.layer.close(index);
          });
        }
        else{
          msgFaild(data.msg);
        }
      }
    });

  });
</script>

<style>
  .laydate-time-list{padding-bottom:0;overflow:hidden}
  .laydate-time-list>li{width:50%!important;}
  .laydate-time-list>li:last-child { display: none;}
  .laydate-time-list>li>ol>li{padding-left: 53px!important;}
  .button-content{
    padding: 9px 15px;
  }
  .link-content{
    color:#1E9FFF;
    cursor: pointer;
  }
</style>
